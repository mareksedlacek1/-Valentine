<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Will You Be My Valentine?</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      background: #d7263d;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      height: 100vh;
      width: 100vw;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-sizing: border-box;
      overflow: hidden;
      overscroll-behavior: none;
    }
    .container {
      text-align: center;
      width: 100vw;
      max-width: 100vw;
      box-sizing: border-box;
      padding: 0 0.5rem;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 1.2rem;
      letter-spacing: 1px;
      word-break: break-word;
    }
    .buttons {
      position: relative;
      min-height: 60px;
      height: 30vh;
      max-height: 200px;
      width: 100vw;
      max-width: 100vw;
      box-sizing: border-box;
    }
    #yesBtn {
      position: absolute;
      left: 50%;
      bottom: 10px;
      transform: translateX(-50%);
      z-index: 1;
    }
    #noBtn {
      position: absolute;
      max-width: 90vw;
      z-index: 2;
    }
    button {
      padding: 1.2rem 2.2rem;
      font-size: 1.3rem;
      border: none;
      border-radius: 2rem;
      cursor: pointer;
      background: #fff;
      color: #d7263d;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: background 0.2s, color 0.2s, transform 0.2s;
      position: relative;
      max-width: 90vw;
      word-break: break-word;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    button:active {
      transform: scale(0.95);
    }
    #noBtn {
      position: absolute;
      max-width: 90vw;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.1rem;
      }
      .buttons {
        min-height: 36px;
        height: 20vh;
        max-height: 100px;
      }
      #yesBtn {
        bottom: 5px;
        padding: 0.8rem 1.1rem;
        font-size: 1rem;
        border-radius: 1.2rem;
      }
      #noBtn {
        padding: 0.8rem 1.1rem;
        font-size: 1rem;
        border-radius: 1.2rem;
      }
      .container {
        padding: 0 0.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
        <!-- Hidden form for Google Forms submission -->
        <form id="googleForm" action="https://docs.google.com/forms/d/e/1FAIpQLSeIXoRH54ccme8EC8Id9P4zN7DCdbyzC39lIfFizpKmgZGjkQ/formResponse" method="POST" target="hidden_iframe" style="display:none;">
          <input name="entry.1301521270" id="googleClicks" type="hidden" value="0">
          <input name="entry.777833274" id="googleResponse" type="hidden" value="">
        </form>
        <iframe name="hidden_iframe" style="display:none;"></iframe>
    <h1>Will you be my Valentine?</h1>
    <div id="clickCounter" style="font-size:1.2rem;margin-bottom:1.5rem;color:#fff;font-weight:bold;">Clicks: 0</div>
    <div id="lastResult" style="font-size:1.1rem;margin-bottom:1.5rem;color:#fff;"></div>
    <div class="buttons" style="position: relative; min-height: 60px; height: 30vh; max-height: 200px;">
      <button id="yesBtn">Yes</button>
      <button id="noBtn">No</button>
    </div>
  </div>
  <!-- Custom Modal Popup -->
  <div id="popupModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;">
    <div id="popupContent" style="background:#fff;color:#d7263d;padding:2.5rem 2rem 2rem 2rem;border-radius:2rem;box-shadow:0 8px 32px rgba(0,0,0,0.25);text-align:center;max-width:90vw;position:relative;animation:popIn 0.4s cubic-bezier(.68,-0.55,.27,1.55);">
      <span id="popupEmoji" style="font-size:3rem;display:block;margin-bottom:1rem;"></span>
      <span id="popupText" style="font-size:1.5rem;font-weight:bold;"></span>
      <br>
      <button id="closePopup" style="margin-top:2rem;padding:0.7rem 2.5rem;font-size:1.2rem;border:none;border-radius:1.5rem;background:#d7263d;color:#fff;font-weight:bold;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.1);transition:background 0.2s;">Close</button>
    </div>
  </div>
  <style>
    @keyframes popIn {
      0% { transform: scale(0.7); opacity: 0; }
      80% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    #popupModal { display: flex; }
    #popupModal[style*="display:none"] { display: none !important; }
    #popupContent { animation: popIn 0.4s cubic-bezier(.68,-0.55,.27,1.55); }
    #closePopup:active { background: #a81b2b; }
  </style>
  <script>
    // Submit click count and response to Google Form
    function submitToGoogleForm(clicks, response) {
      document.getElementById('googleClicks').value = clicks;
      document.getElementById('googleResponse').value = response;
      document.getElementById('googleForm').submit();
    }
        // Show last result if available
        const lastResultDiv = document.getElementById('lastResult');
        function updateLastResultDisplay() {
          const last = localStorage.getItem('valentine_last_clicks');
          if (last !== null) {
            lastResultDiv.textContent = `Last total clicks : ${last}`;
          } else {
            lastResultDiv.textContent = '';
          }
        }
        updateLastResultDisplay();
    let leftClickCount = 0;
    const clickCounter = document.getElementById('clickCounter');

    const noBtn = document.getElementById('noBtn');
    const yesBtn = document.getElementById('yesBtn');
    const popupModal = document.getElementById('popupModal');
    const popupText = document.getElementById('popupText');
    const popupEmoji = document.getElementById('popupEmoji');
    const closePopup = document.getElementById('closePopup');

    // Set initial position for No button
    function setNoBtnPosition() {
      // Move No button anywhere in the visible window, avoiding the Yes button at the bottom center
      const padding = 10;
      // Use the .container as the frame of reference
      const container = document.querySelector('.container');
      const contRect = container.getBoundingClientRect();
      // Temporarily set to (0,0) to get correct size
      noBtn.style.left = '0px';
      noBtn.style.top = '0px';
      const btnRect = noBtn.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();
      // Use clientWidth/clientHeight for viewport (avoids scrollbars)
      const winWidth = document.documentElement.clientWidth;
      const winHeight = document.documentElement.clientHeight;
      const maxLeft = winWidth - btnRect.width - padding;
      const maxTop = winHeight - btnRect.height - padding;
      let left, top;
      let tries = 0;
      do {
        left = Math.random() * maxLeft;
        top = Math.random() * (maxTop - 60); // 60px buffer for bottom elements
        // Avoid overlap with Yes button (bottom center)
        const noBtnArea = {
          left: left,
          right: left + btnRect.width,
          top: top,
          bottom: top + btnRect.height
        };
        const yesArea = {
          left: yesRect.left - padding,
          right: yesRect.right + padding,
          top: yesRect.top - padding,
          bottom: yesRect.bottom + padding
        };
        // Check for overlap
        const overlap = !(noBtnArea.right < yesArea.left ||
                          noBtnArea.left > yesArea.right ||
                          noBtnArea.bottom < yesArea.top ||
                          noBtnArea.top > yesArea.bottom);
        if (!overlap) break;
        tries++;
      } while (tries < 20);
      // Clamp to window
      left = Math.max(padding, Math.min(left, winWidth - btnRect.width - padding));
      top = Math.max(padding, Math.min(top, winHeight - btnRect.height - padding - 60));
      noBtn.style.left = left + 'px';
      noBtn.style.top = top + 'px';
    }

    // Reposition No button on window resize to keep it in frame
    window.addEventListener('resize', setNoBtnPosition);

    setNoBtnPosition();

    // No button moves only on timer, not on hover or click

    // Move No button every 10 seconds automatically
    setInterval(setNoBtnPosition, 1000);

    // Show custom popup
    function showPopup(message, emoji) {
      popupText.textContent = message;
      popupEmoji.textContent = emoji;
      popupModal.style.display = 'flex';
    }

    // Hide popup
    closePopup.onclick = function() {
      popupModal.style.display = 'none';
    };


    // Increment leftClickCount for every left click anywhere except Close button
    document.addEventListener('click', function(e) {
      if (e.button === 0 && e.target !== closePopup) {
        leftClickCount++;
        updateClickCounter();
      }
    });

    // Show popup, submit to Google Form, and reset count on No button click
    noBtn.addEventListener('click', function(e) {
      e.preventDefault();
      let triesMsg = `\nTotal clicks: ${leftClickCount}`;
      showPopup('You lose' + triesMsg, 'ðŸ’”');
      submitToGoogleForm(leftClickCount, 'no');
      localStorage.setItem('valentine_last_clicks', leftClickCount);
      updateLastResultDisplay();
      leftClickCount = 0;
      updateClickCounter();
    });

    // Update the live click counter
    function updateClickCounter() {
      clickCounter.textContent = `Clicks: ${leftClickCount}`;
    }

    // Yes button click
    yesBtn.addEventListener('click', function() {
      let triesMsg = `\nTotal clicks: ${leftClickCount}`;
      showPopup('You win!' + triesMsg, 'ðŸ”¥');
      submitToGoogleForm(leftClickCount, 'yes');
      localStorage.setItem('valentine_last_clicks', leftClickCount);
      updateLastResultDisplay();
      leftClickCount = 0;
      updateClickCounter();
    });
  </script>
</body>
</html>
